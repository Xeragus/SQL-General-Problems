PASSENGER ( PASSPORTNO, NAME, SURNAME, STREET, NUMBER, CITY, TELEPHONE)
FLIGHT_LINE ( LINE_CODE, FROM, TO, DEPART_TIME, ARRIVE_TIME)
FLIGHT ( LINE_CODE*, FLIGHTNO, DATE)
RESERVATION ( PASSPORTNO*, LINE_CODE*, FLIGHTNO*, DATE)
EMPLOYEE (CODE, NAME, SURNAME, SALARY)
CREW ( LINE_CODE*, FLIGHTNO*, EMPLOYEECODE*)
PILOT (CODE*)
PLANE_TYPE ( MODELNO, MANUFACTURER, MODELNAME)
PLANE ( SERIALNO, MODELNO*, CAPACITY, AIRWORTHINESS)
CAN_FLY (PILOTCODE*, MODELNO*)

1. FIND THE NAMES OF ALL PASSENGERS THAT DON'T HAVE DEPARTURE ON 25.15.2015
1.1 WITH TEMPORARY TABLE

SELECT R.PASSPORTNO, R.FLIGHTNO
INTO #RES_FLIGHT
FROM RESERVARION R INNER JOIN FLIGHT FL 
	ON R.FLIGHTNO = FL.FLIGHTNO
WHERE FL.DATE='2015-12-25'


SELECT PA.NAME
FROM PASSENGER PA LEFT JOIN #RES_FLIGHT RF
	ON PA.PASSPORTNO = RF.PASSPORTNO
WHERE RF.FLIGHTNO IS NULL

1.2 WITH COMMON TABLE EXPRESSION

WITH RES_FLIGHT AS
(SELECT R.PASSPORTNO, R.FLIGHTNO
FROM RESERVATION R
INNER JOIN FLIGHT FL ON R.FLIGHTNO = FL.FLIGHTNO
WHERE FL.DATE='2015-12-25')

SELECT PA.NAME
FROM PASSENGER PA LEFT JOIN
RES_FLIGHT RF
ON RF.PASSPORTNO=PA.PASSPORTNO
WHERE RF.FLIGHTNO IS NULL

2. SHOW THE TOTAL COUNT OF DEPARTURES THAT EVERY PILOT HAS

SELECT P.CODE, COUNT(C.LINE_CODE)
FROM CREW C RIGHT JOIN PILOT P
ON P.CODE=C.EMPLOYEECODE
GROUP BY P.CODE
ORDER BY P.CODE

3. FIND THE PASSPORT NUMBERS OF THE PASSENGERS THAT DON'T HAVE A DEPARTURE
UNDER THE PILOT WITH CODE 23412

CREATE VIEW PILOT_FLIGHT(CODE, LINE_CODE, FLIGHTNO)
SELECT P.CODE, C.LINE_CODE, C.FLIGHTNO
FROM CREW C INNER JOIN PILOT P
	ON C.EMPLOYEECODE = P.CODE

CREATE VIEW PASSENGER_FLIGHT(PASSPORTNO, LINE_CODE, FLIGHTNO)
SELECT P.PASSPORTNO, R.LINE_CODE, R.FLIGHTNO
FROM PASSENGER P INNER JOIN RESERVATION R
	ON P.PASSPORTNO = R.PASSPORTNO


SELECT PAF.PASSPORTNO
FROM PASSENGER_FLIGHT PAF LEFT JOIN PILOT_FLIGHT PIF
	ON PAF.LINE_CODE=PIF.LINE_CODE AND PAF.FLIGHTNO=PIF.FLIGHTNO
WHERE PIF.CODE = 23412
GROUP BY PAF.PASSPORTNO
HAVING COUNT(PIF.CODE)=0