MODEL(ID, NAME, DESCRIPTION)
SIZE(ID,NAME,DESCRIPTION)
COLOR(ID,NAME)
STOREPRODUCT(ID, MODELID*, SIZEID*, COLORID*, RETAILPRICE, ITEMSONSTOCK)
FACTORYPRODUCT (ID, MODELID*, SIZEID*, COLORID*, FACTORYPRICE)

CREATE TABLE MODEL
(
ID INT IDENTITY PRIMARY KEY,
NAME NVARCHAR(100) NOT NULL,
DESCRIPTION NVARCHAR(200) NULL
)

CREATE TABLE SIZE 
(
ID INT IDENTITY PRIMARY KEY,
NAME NVARCHAR(100) NOT NULL,
DESCRIPTION NVARCHAR(200) NULL
)

CREATE TABLE COLOR 
(
ID INT IDENTITY PRIMARY KEY,
NAME NVARCHAR(100) NOT NULL
)

CREATE TABLE STOREPRODUCT
(
ID INT IDENTITY PRIMARY KEY,
MODELID INT NULL REFERENCES MODEL(ID) 
ON DELETE SET NULL ON UPDATE CASCADE,
SIZEID INT NULL REFERENCES SIZE(ID)
ON DELETE SET NULL ON UPDATE CASCADE,
COLORID INT NULL REFERENCES COLOR(ID)
ON DELETE SET NULL ON UPDATE CASCADE,
FACTORYPRICE FLOAT NOT NULL DEFAULT 0
)

CREATE TABLE FACTORYPRODUCT
(
ID INT IDENTITY PRIMARY KEY,
MODELID INT NULL REFERENCES MODEL(ID) 
ON DELETE SET NULL ON UPDATE CASCADE,
SIZEID INT NULL REFERENCES SIZE(ID) 
ON DELETE SET NULL ON UPDATE CASCADE,
COLORID INT NULL REFERENCES COLOR(ID) 
ON DELETE SET NULL ON UPDATE CASCADE,
FACTORYPRICE FLOAT NOT NULL DEFAULT 0
)

INSERT INTO MODEL(NAME)
VALUES ('JEANS'), ('SHIRT')

INSERT INTO COLOR(NAME)
VALUES ('BLUE'), ('YELLOW'), ('RED')

INSERT INTO SIZE(NAME)
VALUES ('S'), ('M'), ('L')

1. THE TABLE FACTORYPRODUCT IS EMPTY AND SHOULD BE FILLED WITH EVERY
POSSIBLE COMBINATION OF MODELS, SIZES AND COLORS 

INSERT INTO FACTORYPRODUCT(MODELID,SIZEID,COLORID)
SELECT M.ID, S.ID, C.ID
FROM MODEL M CROSS JOIN SIZE S CROSS JOIN COLOR C

UPDATE FACTORYPRODUCT
SET FACTORYPRICE=50*MODELID*SIZEID*COLORID

2. FIND THE INFO FOR THE PRODUCTS THAT ARE PRODUCED IN THE FACTORY,
BUT ARE NOT AVAILABLE IN THE STORY

CREATE VIEW FACTORYPRODUCTSNOTINSTORE AS
SELECT FP.*
FROM FACTORYPRODUCT FP LEFT OUTER JOIN STOREPRODUCT SP
ON FP.MODELID=SP.MODELID AND FP.SIZEID=SP.SIZE ID AND FP.COLORID=SP.COLORID
WHERE SP.ID IS NULL

SELECT * FROM FACTORYPRODUCTSNOTINSTORE

3. FIND THE PERCENTAGE OF THE RED PRODUCTS FROM THE FACTORY THAT ARE
AVAILABLE IN THE STORE

CREATE VIEW REDPRODUCTS AS
SELECT ID
FROM COLOR
WHERE COLOR.NAME='RED'

SELECT (SELECT COUNT(SP.*) 
FROM STOREPRODUCT SP INNER JOIN REDPRODUCTS RP
ON SP.COLORID=RP.ID)*1.0 /
(SELECT COUNT(FP.*) 
FROM FACTORYPRODUCT FP INNER JOIN REDPRODUCTS RP 
ON FP.COLORID=RP.ID)


4. THE COMPANY WANTS TO STOP THE PRODUCTION OF YELLOW PRODUCTS. REMOVE ALL
YELLOW PRODUCTS FROM THE TABLE FACTORYPRODUCT.

DELETE FROM FACTORYPRODUCT
WHERE COLORID IN 
(SELECT ID
FROM COLOR C
WHERE C.NAME='YELLOW'
)

5. FIND THE PRODUCTS THAT ARE STILL IN THE STORES, BUT THE FACTORY IS NOT
PRODUCING THEM ANYMORE

SELECT SP.*
FROM FACTORYPRODUCT FP RIGHT OUTER JOIN STOREPRODUCT SP
ON FP.MODELID=SP.MODELID AND FP.SIZEID=SP.SIZEID AND FP.COLORID=SP.COLORID
WHERE FP.ID=NULL

6. RETURN ALL THE PRODUCTS (FROM THE FACTORY AND THE STORE) THAT ARE STILL
IN THE COMPANY'S POSSESSION

6.1 WITHOUT DUPLICATES:

SELECT FP.MODELID, FP.COLORID, FP.SIZEID
FROM FACTORYPRODUCT FP
UNION
SELECT SP.MODELID, SP.COLORID, SP.SIZEID
FROM STOREPRODUCT SP

6.2 WITH DUPLICATES:

SELECT FP.MODELID, FP.COLORID, FP.SIZEID
FROM FACTORYPRODUCT FP
UNION
SELECT SP.MODELID, SP.COLORID, SP.SIZEID
FROM STOREPRODUCT SP

7. RETURN THE DIFFERENCE BETWEENTHE PRICE OF THE PRODUCT IN THE FACTORY
AND IN THE STORE FOR THE PRODUCTS THAT ARE AVAILABLE ON BOTH PLACES, OR
THE PRICE OF THE PRODUCT IN THE FACTORY IF THAT PRODUCT IS AVAILABLE
ONLY IN THE FACTORY, OR THE PRICE OF THE PRODUCT IN THE STORY IF THE
PRODUCT IS AVAILABLE ONLY IN THE STORY

SELECT ISNULL(FP.MODELID, SP.MODELID) MODELID,
	ISNULL(FP.SIZEID, SP.SIZEID) SIZEID,
	ISNULL(FP.COLORID, SP.COLORID) COLORID,
	CASE WHEN FP.ID IS NULL THEN SP.RETAILPRICE
		WHEN SP.ID IS NULL THEN FP.FACTORYPRICE
		ELSE SP.RETAILPRICE-FP.FACTORYPRICE
FROM FACTORYPRODUCT FP FULL OUTER JOIN STOREPRODUCT SP 
ON FP.MODELID = SP.MODEILD AND FP.SIZEID=SP.SIZEID AND FP.COLORID=SP.COLORID

8. MAKE THE CAPACITY FOR BLUE PRODUCTS 2 TIMES BIGGER

UPDATE STOREPRODUCT
SET ITEMSONSTOCK=ITEMSONSTOCK*2
FROM COLOR
WHERE COLOR.ID = STOREPRODUCT.COLORID AND COLOR.NAME='BLUE'



























