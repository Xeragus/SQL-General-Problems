# 1. FIND THE IDS AND THE NAMES OF ALL EMPLOYEES AND THE NAME OF THE PLAY
# IN WHICH THEY PLAYED THE MAIN ROLE AND WHICH IS PLAYED ON THE MAIN STAGE
# AS REGULAR PLAY

SELECT DISTINCT INNER_QUERY.K, INNER_QUERY.IMEP, VRABOTEN.IMEV
FROM 
(SELECT ULOGI.V AS K, PRETSTAVI.IMEP
FROM ULOGI, PRETSTAVI
WHERE ULOGI.IMA_ULOGA='GLAVNA' AND
	PRETSTAVI.SCENA='GOLEMA' AND
	PRETSTAVI.STATUS'REDOVNA') INNER_QUERY, VRABOTEN
WHERE INNER_QUERY.K = VRABOTEN.K

# 2. FIND THE ACTOR THAT PLAYED MOST FREQUENTLY

CREATE VIEW POM1( VRAB, CNT ) AS
(
SELECT VR.IMEV IMV, COUNT (U.P)
FROM VRABOTENI VR, ULOGI U
WHERE VR.V=U.V
GROUP BY VR.IMEV
)
CREATE VIEW POM2( MAKS ) AS
(
SELECT MAX(POM1.CNT)
FROM POM1
)
SELECT VRAB
FROM POM1, POM2
WHERE POM1.CNT = POM2.MAKS

# 3. FIND THE ACTOR WITH THE HIGHEST AVERAGE SALARY

CREATE VIEW AKTER1(IME,HONORAR) AS
(
SELECT V.IMEV, AVG(Z.HONORAR)
FROM VRABOTENI V, ZARABOTUVA Z
WHERE V.V=Z.V
GROUP BY V.IMEV
)
CREATE VIEW AKTER2(MAX) AS
(
SELECT MAX(HONORAR)
FROM AKTER1
)
SELECT IME, AKTER1.HONORAR
FROM AKTER1, AKTER2
WHERE AKTER1.HONORAR=AKTER2.MAX

# 4. FIND THE NUMBER OF DISTINCT SHOWS THAT WERE PLAYED, SEPARATELY FOR EVERY CITY, SORTED BY THE NAME OF THE CITY

SELECT T.GRAD, COUNT(DISTINCT P.IMEP)
FROM TEATRI T, BILETI B, PRETSTAVI P
WHERE T.T=B.T AND B.P = P.P
GROUP BY T.GRAD
ORDER BY T.GRAD

# 5. FIND THE SHOWS FOR WHOM THE TOTAL PROFIT OF THE SALES IS BIGGER
# THAN THE TOTAL OF THE SALARIES PAYED

create view view1(sumasuma, pp) as
(select suma, A.p 
from (select sum(cena*prodadeni) as suma, P 
from bileti
group by p ) A, (select sum(honorar) as suma2, p
from zarabotuva
group by p ) B
where a.p = b.p and a.suma > b.suma2)

select imep, sumasuma
from view1, pretstavi
where sdsd.pp = pretstavi.p
